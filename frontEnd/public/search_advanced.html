<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="./shop.css" />
    <link rel="stylesheet" href="./styles.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type="module">
      import { loadHTMLWithScriptAndCallback } from './HTMLLoader.js';
      import { updateNavbarDisplay } from './navbar.js';
      import { addToCart } from './cartModule.js';
      import { fetchSelectableOptions } from './searchModule.js';

      // Call loadHTMLWithScript function to include navbar.html, load navbar.js and update cart item count
      loadHTMLWithScriptAndCallback("navbar.html","navbar","navbar.js", updateNavbarDisplay);
      
      // Populate selectable options
      fetchSelectableOptions(
        (item) => item.madeIn,
        "madeInInput",
        "Select Country of Origin"
      );
      fetchSelectableOptions(
        (item) => item.distributor,
        "distributorInput",
        "Select Distributor"
      );

      // Function to display items based on search criteria
      function displayItems(items) {
        const itemList = document.getElementById("itemContainer");
        itemList.innerHTML = "";

        items.forEach((item) => {
          const itemDiv = document.createElement("div");
          itemDiv.classList.add("item");

          const img = document.createElement("img");
          img.src = item.img;
          img.alt = item.name;
          img.style.width = "100px";

          const name = document.createElement("h3");
          name.textContent = item.name;

          const description = document.createElement("p");
          description.textContent = item.description;

          const price = document.createElement("p");
          price.textContent = "Price: $" + item.price.toFixed(2);

          const country = document.createElement("p");
          country.textContent = "Country: " + item.madeIn;

          const button = document.createElement("button");
          button.textContent = "Add to Cart";
          button.addEventListener("click", function () {
            addToCart(item);
          });

          itemDiv.appendChild(img);
          itemDiv.appendChild(name);
          itemDiv.appendChild(description);
          itemDiv.appendChild(price);
          itemDiv.appendChild(country);
          itemDiv.appendChild(button);

          itemList.appendChild(itemDiv);
        });

        if (items.length === 0) {
          const noResults = document.createElement("div");
          noResults.textContent = "No items found.";
          itemList.appendChild(noResults);
        }
      }

      async function fetchAdvancedSearch1(price, quality, distributor) {
        try {
          const response = await fetch(
            `http://localhost:3000/items/price-and-quality?price=${price}&quality=${quality}&distributor=${distributor}`
          );
          const items = await response.json();
          console.log(items);
          displayItems(items);
        } catch (error) {
          console.error("Error fetching items:", error);
        }
      }

      async function fetchAdvancedSearch2(color, madeIn, weight) {
        try {
          const response = await fetch(
            `http://localhost:3000/items/criteria?color=${color}&madeIn=${madeIn}&weight=${weight}`
          );
          const items = await response.json();
          console.log(items);
          displayItems(items);
        } catch (error) {
          console.error("Error fetching items:", error);
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("advancedSearchButton1")
          .addEventListener("click", function () {
            const price = document.getElementById("priceInput").value.trim();
            const quality = document
              .getElementById("qualityInput")
              .value.trim();
            const distributor = document
              .getElementById("distributorInput")
              .value.trim();
            fetchAdvancedSearch1(price, quality, distributor);
          });

        document
          .getElementById("advancedSearchButton2")
          .addEventListener("click", function () {
            const color = document.getElementById("colorInput").value.trim();
            const madeIn = document.getElementById("madeInInput").value.trim();
            const weight = document.getElementById("weightInput").value.trim();
            fetchAdvancedSearch2(color, madeIn, weight);
          });
      });
    </script>
    <script>
      // Script for tab selection
      function openForm(evt, formName) {
        // Hide all tab contents
        const tabcontent = document.getElementsByClassName("tabcontent");
        for (let i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }

        // Remove the background color of all tablinks/buttons
        const tablinks = document.getElementsByClassName("tablinks");
        for (let i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        // Show the current tab, and add an "active" class to the button that opened the tab
        document.getElementById(formName).style.display = "block";
        evt.currentTarget.className += " active";
      }

      // Automatically click the default tab
      document.getElementById("defaultOpen").click();
    </script>
    <title>Advanced Item Search</title>
  </head>
  <body>
    <div id="navbar"></div>

    <h1>Advanced Item Search</h1>

    <div class="tab">
      <button
        class="tablinks"
        onclick="openForm(event, 'Form1')"
        id="defaultOpen"
      >
        Form 1
      </button>
      <button class="tablinks" onclick="openForm(event, 'Form2')">
        Form 2
      </button>
    </div>

    <div id="Form1" class="tabcontent">
      <h3>Criteria 1: Price/Quality/Distributor</h3>
      <div id="advancedSearchForm1">
        <div class="form-group">
          <input
            type="text"
            id="priceInput"
            class="search-input"
            placeholder="Price..."
          />
          <select id="qualityInput" class="search-input">
            <option value="">Select Quality</option>
            <option value="High">High</option>
            <option value="Mid">Mid</option>
            <option value="Low">Low</option>
          </select>
          <select id="distributorInput" class="search-input">
            <option value="">Select Distributor</option>
          </select>
        </div>
        <button id="advancedSearchButton1" class="search-button">Search</button>
      </div>
    </div>

    <div id="Form2" class="tabcontent">
      <h3>Criteria 2: Color/Made In/Weight</h3>
      <div id="advancedSearchForm2">
        <div class="form-group">
          <input
            type="text"
            id="colorInput"
            class="search-input"
            placeholder="Color..."
          />
          <select id="madeInInput" class="search-input">
            <option value="">Select Country of Origin</option>
          </select>
          <input
            type="text"
            id="weightInput"
            class="search-input"
            placeholder="Weight..."
          />
        </div>
        <button id="advancedSearchButton2" class="search-button">Search</button>
      </div>
    </div>

    <div class="item-container" id="itemContainer"></div>
    <!-- Item list will be dynamically populated here -->

    <script type="module">
      
    </script>
  </body>
</html>
